<%- include('../partials/header', { title: 'Admin Dashboard' }) %>

<h1>Orders</h1>

<% if (!orders.length) { %>
  <p>No orders yet.</p>
<% } %>

<div class="orders">
  <% orders.forEach(o => { %>
    <section class="order-card">
      <header class="order-head">
        <div>
          <strong>#<%= o.id %></strong>
          <span class="muted">• <%= o.created_at %></span>
        </div>
        <div>
          <span class="badge"><%= o.status %></span>
        </div>
      </header>

      <div class="order-body">
        <div class="col">
          <h4>Customer</h4>
          <p><%= o.user_name || 'Guest' %> (<%= o.user_email || '—' %>)</p>
          <p><strong>Name:</strong> <%= o.name %></p>
          <p><strong>Phone:</strong> <%= o.phone %></p>
          <p><strong>Address:</strong> <%= o.address %></p>
        </div>
        <div class="col">
          <h4>Items</h4>
          <ul class="list">
            <% (orderItemsByOrder[o.id] || []).forEach(it => { %>
              <li><%= it.quantity %> × <%= it.product_name %> — $<%= ((it.price_cents*it.quantity)/100).toFixed(2) %></li>
            <% }) %>
          </ul>
          <p class="total">Total: $<%= (o.total_cents/100).toFixed(2) %></p>
        </div>
        <div class="col">
          <h4>Update Status</h4>
          <form method="POST" action="/admin/orders/<%= o.id %>/status" class="form">
            <select name="status" required>
              <% statuses.forEach(s => { %>
                <option value="<%= s %>" <%= s === o.status ? 'selected' : '' %>><%= s %></option>
              <% }) %>
            </select>
            <button class="btn">Save</button>
          </form>
        </div>
      </div>
    </section>
  <% }) %>
</div>

<%- include('../partials/footer') %>